sysbus:
    init:
        Tag <0x0 0x800000> "boot_partition / storage_partition / slot0_partition / slot1_partition"
        Tag <0x500b4000 0x4000> "flexcomm4_lpspi4 / flexcomm4_lpi2c4 / flexcomm5 / flexcomm5_lpspi5 / flexcomm5_lpuart5 / flexcomm5_lpi2c5 / flexcomm6_lpspi6 / flexcomm6_lpuart6 / flexcomm6_lpi2c6 / flexcomm7_lpspi7 / flexcomm7_lpuart7"
        Tag <0x500d4000 0x4000> "flexcan0"
        Tag <0x500d8000 0x4000> "flexcan1"
        Tag <0x50092000 0x3000> "flexcomm0 / flexcomm0_lpspi0 / flexcomm0_lpuart0 / flexcomm0_lpi2c0 / flexcomm1_lpspi1 / flexcomm1_lpuart1 / flexcomm1_lpi2c1 / flexcomm2_lpspi2"
        Tag <0x500b8000 0x2800> "flexcomm8 / flexcomm8_lpspi8 / flexcomm8_lpuart8 / flexcomm8_lpi2c8 / flexcomm9 / flexcomm9_lpspi9 / flexcomm9_lpuart9 / flexcomm9_lpi2c9"
        Tag <0x40100000 0x1200> "enet"
        Tag <0x40113000 0x1000> "opamp1"
        Tag <0x5000d000 0x1000> "ctimer1"
        Tag <0x5000e000 0x1000> "ctimer2"
        Tag <0x5000f000 0x1000> "ctimer3"
        Tag <0x50010000 0x1000> "ctimer4"
        Tag <0x50013000 0x1000> "mrt0"
        Tag <0x50016000 0x1000> "wwdt0"
        Tag <0x50021000 0x1000> "i3c0"
        Tag <0x50022000 0x1000> "i3c1"
        Tag <0x50033000 0x1000> "smartdma"
        Tag <0x50040000 0x1000> "gpio5"
        Tag <0x50042000 0x1000> "portf"
        Tag <0x50043000 0x1000> "ftfe"
        Tag <0x50049000 0x1000> "os_timer"
        Tag <0x5004a000 0x1000> "lptmr0"
        Tag <0x5004b000 0x1000> "lptmr1"
        Tag <0x5004c000 0x1000> "rtc"
        Tag <0x50051000 0x1000> "lpcmp0"
        Tag <0x50052000 0x1000> "lpcmp1"
        Tag <0x50053000 0x1000> "lpcmp2"
        Tag <0x50080000 0x1000> "edma0"
        Tag <0x50091000 0x1000> "sc_timer"
        Tag <0x50095000 0x1000> "flexcomm3_lpspi3 / flexcomm3_lpuart3"
        Tag <0x50096000 0x1000> "gpio0"
        Tag <0x50098000 0x1000> "gpio1"
        Tag <0x5009a000 0x1000> "gpio2"
        Tag <0x5009c000 0x1000> "gpio3"
        Tag <0x5009e000 0x1000> "gpio4"
        Tag <0x500a0000 0x1000> "edma1"
        Tag <0x500dd000 0x1000> "usb0"
        Tag <0x50105000 0x1000> "flexio0"
        Tag <0x50106000 0x1000> "sai0"
        Tag <0x50107000 0x1000> "sai1"
        Tag <0x50109000 0x1000> "usdhc0"
        Tag <0x5010a000 0x1000> "usbphy1"
        Tag <0x5010b000 0x1000> "usb1"
        Tag <0x5010c000 0x1000> "micfil"
        Tag <0x5010d000 0x1000> "lpadc0"
        Tag <0x5010e000 0x1000> "lpadc1"
        Tag <0x5010f000 0x1000> "dac0"
        Tag <0x50110000 0x1000> "opamp0"
        Tag <0x50112000 0x1000> "dac1"
        Tag <0x50115000 0x1000> "opamp2"
        Tag <0x50116000 0x1000> "porta"
        Tag <0x50117000 0x1000> "portb"
        Tag <0x50118000 0x1000> "portc"
        Tag <0x50119000 0x1000> "portd"
        Tag <0x5011a000 0x1000> "porte"
        Tag <0x50054000 0x200> "crypto@54000"
        Tag <0x500b2000 0xec> "mbox"
        Tag <0xe000ed90 0x40> "mpu"
        Tag <0x50111000 0x14> "vref"
        Tag <0x11100000 0x10> "uuid"
        Tag <0xe000e010 0x10> "systick"
        Tag <0x500c0000 0x6> "ewm0"

SCG0CSR_CLK_SPOOF: Python.PythonPeripheral @ sysbus 0x4008F010
    size: 0x4
    initable: true
    script: '''
if request.IsInit: tick = False
if request.IsRead: request.Value = 0x3000000 if tick else 0x2000000; tick = not tick
'''

unknown5: Python.PythonPeripheral @ sysbus 0x50044010
    size: 0x4
    initable: true
    script: "count = 0 if request.IsInit else (count + 1);request.Value = 0x2000000 if count < 2 else 0x5000000"

flash: Memory.MappedMemory @ sysbus 0x10000000
    size: 0x200000

sramx: Memory.MappedMemory @ sysbus 0x14000000
    size: 0x18000

sram0: Memory.MappedMemory @ sysbus 0x30000000
    size: 0x50000

sramg: Memory.MappedMemory @ sysbus 0x30050000
    size: 0x10000

sramh: Memory.MappedMemory @ sysbus 0x30060000
    size: 0x8000

w25q64jvssiq: Memory.MappedMemory @ sysbus 0x90000000
    size: 0x800000

// autogenerated

nvic0: IRQControllers.NVIC @ {
    sysbus new Bus.BusPointRegistration { address: 0xe000e000; cpu: cpu0 }
}
    -> cpu0@0
    systickFrequency: 150000000

cpu0: CPU.CortexM @ sysbus
    cpuType: "cortex-m33"
    nvic: nvic0

flexpwm0: Timers.IMXRT_PWM @ sysbus 0x500ce000
    0->nvic0@112
    1->nvic0@113

flexpwm1: Timers.IMXRT_PWM @ sysbus 0x500d0000
    0->nvic0@118
    1->nvic0@119

flexspi: SPI.IMXRT_FlexSPI @ sysbus 0x500c8000
    ->nvic0@58

flexcomm1: UART.NXP_FLEXCOMM @ sysbus 0x50093000
    ->nvic0@36

flexcomm2lpuart2: UART.NXP_FLEXCOMM @ sysbus 0x50094000
    ->nvic0@37

flexcomm3: UART.NXP_FLEXCOMM @ sysbus 0x50095000
    ->nvic0@38

flexcomm4lpuart4: UART.NXP_FLEXCOMM @ sysbus 0x500b4000
    ->nvic0@39

flexcomm6: UART.NXP_FLEXCOMM @ sysbus 0x500b6000
    ->nvic0@41

flexcomm7: UART.NXP_FLEXCOMM @ sysbus 0x500b7000
    ->nvic0@42

ctimer0: Timers.LPC_CTimer @ sysbus 0x5000c000
    ->nvic0@31

syscon: Python.PythonPeripheral @ sysbus 0x50000000
    size: 0x1000
    script: "request.Value = {0x264: 0x3, 0x284: 0x3, 0x2B0: 0x4, 0x320: 0xFF, 0x3A0: 0xFF, 0xA18: 0xFF}.get(request.Offset, (0x0 if (request.Counter % 2) else 0xFFFFFFFF))"

// cortex-m overlay

dwt: Miscellaneous.DWT @ sysbus 0xE0001000
    frequency: 72000000

// nxp,mcx overlay

sysbus:
    init add:
        Tag <0x40090040 0x4> "SRAMCTL_ACK" 0x80000000
        Tag <0x4008F300 0x4> "FIRCCSR_VALID" 0x81000000
        Tag <0x4008F200 0x4> "SIRCCSR_VALID" 0x1000000

// nxp,mcxn947 overlay

sysbus:
    init add:
        Tag <0x50045040 4> "UNKNOWN1" 0xF0000000
        Tag <0x50044300 4> "UNKNOWN2" 0x0F000000
        Tag <0x50044500 4> "UNKNOWN3" 0x0F000000
        Tag <0x50044600 4> "UNKNOWN4" 0x0F000000

// Robot simulation peripherals
// Python peripheral files use $ORIGIN to reference files in same directory

$motor_model?=$ORIGIN/motor_model.py
$turret_model?=$ORIGIN/turret_model.py
$canfd_model?=$ORIGIN/canfd_model.py

motor_fl: Python.PythonPeripheral @ sysbus 0x50001000
    size: 0x100
    initable: true
    filename: $motor_model

motor_fr: Python.PythonPeripheral @ sysbus 0x50001100
    size: 0x100
    initable: true
    filename: $motor_model

motor_rl: Python.PythonPeripheral @ sysbus 0x50001200
    size: 0x100
    initable: true
    filename: $motor_model

motor_rr: Python.PythonPeripheral @ sysbus 0x50001300
    size: 0x100
    initable: true
    filename: $motor_model

turret_sim: Python.PythonPeripheral @ sysbus 0x50002000
    size: 0x100
    initable: true
    filename: $turret_model

canfd_sim: Python.PythonPeripheral @ sysbus 0x50003000
    size: 0x100
    initable: true
    filename: $canfd_model
